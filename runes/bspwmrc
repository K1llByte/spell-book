#!/bin/bash

set -e
case "$(hostname)" in
    weatherlight)
        bspc monitor -d 1 2 3 4 5 6 7 8 9 0
        ;;
    tolaria)
        bspc monitor -O DVI-D-0 DVI-I-1
        bspc monitor DVI-I-1 -d 1 2 3
        bspc monitor DVI-D-0 -d 4 5 6 7 8 9 0
        ;;
esac

if [[ "$(hostname)" = tolaria ]]
then
    bspc config window_gap           10
    bspc config border_width         5
else
    bspc config window_gap           4
    bspc config border_width         3
fi

bspc config split_ratio          0.5
bspc config borderless_monocle   false
bspc config gapless_monocle      false
bspc config remove_unplugged_monitors true
bspc config top_padding          22

xsetroot -cursor_name left_ptr
bspc rule -a floating-terminal state=floating
bspc rule -a feh state=floating
bspc rule -a URxvt state=floating
bspc rule -a Sxiv state=floating
bspc rule -a my-media-player desktop=^10
bspc rule -a Zathura state=tiled
bspc rule -a Surf state=tiled
bspc rule -a Wine state=pseudo_tiled

if ! pgrep sxhkd
then
    sxhkd &
else
    pkill -USR1 -x sxhkd
fi

# if ! pgrep polybar
# then
#     for m in $(xrandr --query | grep " connected" | cut -d" " -f1); do
#         MONITOR=$m polybar --reload example &
#     done
# fi
#[ -e "$PANEL_FIFO" ] && bspc subscribe report > "$PANEL_FIFO" &
pgrep -x lemon && killall lemon
if ! [ -e ~/.config/lemonbar/lemon ]; then
    rustc ~/.config/lemonbar/lemon.rs -o ~/.config/lemonbar/lemon
fi
~/.config/lemonbar/lemon &

until bar_id=$(xdo id -a 'bar_of_the_lemons')
do
  sleep 0.001
done
xdo below -t "$(xdo id -n root)" "$bar_id"
until systray_id=$(xdo id -N 'trayer')
do
  sleep 0.001
done
xdo below -t "$(xdo id -n root)" "$systray_id"

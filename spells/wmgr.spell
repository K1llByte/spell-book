#!/bin/sh
# shellcheck disable=SC2029

mode=add
host="$(hostname)"
while [ "$#" -gt 0 ]; do
    case "$1" in
        -w)
            host=weatherlight
            ;;
        -t)
            host=tolaria
            ;;
        -d)
            mode=delete
            ;;
        -h)
            wall=""
            break
            ;;
        -n)
            shift
            name="$1"
            ;;
        *)
            wall="$1"
            ;;
    esac
    shift
done
if [ "$mode" != delete ] && [ -z "$wall" ]; then
    cat <<EOF
Wallpaper Manager

Usage
    $(basename "$0") [OPTIONS] wallpaper

Options
    -d
        Delete instead of adding
    -w
        Add wallpaper to the weatherlight collection
    -t
        Add wallpaper only to the tolaria collection
    -n name
        Specifiy the wallpaper's name
EOF
    exit 1
fi

[ -z "$name" ] && name="$(basename "$wall")"

case "$mode" in
    add)
        case "$wall" in
            http*)
                wget "$wall" -O "/tmp/$name"
                wall="/tmp/$name"
                ;;
        esac
        scp "$wall" "mirrodin:Pictures/Wallpapers/$name"
        if [ "$host" = weatherlight ]; then
            ssh mirrodin "ln -sfv ~/Pictures/Wallpapers/$name ~/Pictures/Shortlist"
            mv -v "$wall" "Pictures/Wallpapers/$name"
        fi
        ;;
    delete)
        if [ -z "$wall" ]; then
            wall="$(sxiv -g 1800x1000 -b -t -o ~/Pictures/Wallpapers)"
            if [ -z "$wall" ]; then echo please pick a wallpaper to delete; exit 1; fi
        fi
        for w in $wall; do
            ssh mirrodin \
                "find Pictures/ -type l,f -name '$(basename "$w")' | xargs rm -v" | sed "s/'/'mirrodin:/"
            rm -v "$w"
        done
        ;;
esac
